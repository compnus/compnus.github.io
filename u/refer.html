<!DOCTYPE html>
<html lang="en">
<head>
    <script src="../head.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="../script.js" defer></script>
    <script src="wallet.js" defer></script>
    <title>Refer and Earn - CompNUS</title>
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="profile.css" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZW8SQ3EQ1B"></script>
    <script>window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-ZW8SQ3EQ1B');</script>
</head>
<body>
    <script>initHeader("Refer and Earn!");</script>

    <div class="mainscroll">
        <h1 class="tc" style="font-family:Gabarito">Refer your friends and increase your dividend power!</h1>
        <h2 class="tc">Not only that, but both you and your friend will receive $NUS for free!</h2>
        <p class="tc">Keep in mind, besides friends, you can also invite your colleagues, your boss, neighbors, enemies, family members or anything in between!</p>
        <br />
        <div id="referlanding">
            <div>
                <h1>You Receive</h1>
                <div><p>0.001 $NUS</p>
                <p>+10 Dividend Power (while your invitee is active)</p></div>
            </div>
            <div>
                <h1>Invitee Receives</h1>
                <div><p>0.01 $NUS</p></div>
            </div>
            <div class="dlink">
                <h2>Your referral code is your username (&nbsp;<span id="dlinkusername" style="font-weight: normal; user-select: all; -webkit-user-select: all; -moz-user-select: all"></span>&nbsp;)</h2>
                <p>You can also share the following link (click to copy):</p>
                <p id="dlinkurl" onclick="r = this.innerHTML; navigator.clipboard.writeText(r); window.setTimeout(() => this.innerHTML = 'Copied!', 10); window.setTimeout(() => this.innerHTML = r, 2000);">https://loading...</p><br />
                <p>You have invited <b id="invitees">0 users</b> and earned <b id="inviteres">0</b> <span style="font-family: 'currencycompnus'">$</span> so far!</p>
            </div>
        </div>
        <br />
        <p class="tc">Please keep in mind you will not receive dividend power boost if the invited user is offline for more than 30 consecutive days or deletes their account.<br />
        Referring fake accounts will result in losing your eligibility to earn dividends.</p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const { data, error } = await supabase.auth.getUser();

            if (!data.user) {
                return;
            } else if (error) {
                console.error(error);
                return;
            }

            var { data: username } = await supabase.from("users").select("username").eq("id", data.user.id).single();
            document.getElementById("dlinkusername").innerHTML = username.username;
            document.getElementById("dlinkurl").innerHTML = `https://compnus.github.io/u/signup.html?r=${username.username}`;
            const { data: data1, error: error1 } = await supabase.from("udata").select("invitees").eq("user_id", data.user.id).single();
            var invitees = data1.invitees.match(/\(([^)]+)\)/g)?.map(s => s.slice(1, -1)) || [];
            var invites = invitees.length;
            document.getElementById("invitees").innerHTML = invites + (invites == 1 ? " user" : " users");
            if (invites === 1 && invitees[0] === "") invites = 0;
            document.getElementById("inviteres").innerHTML = parseFloat((invites * 0.001).toFixed(3)).toString();
        });

        initFooter();</script>
</body>
</html>